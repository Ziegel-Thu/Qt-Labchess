# 详细报告——TimeChess

## 1. 功能介绍

TimeChess 是一个基于 Qt 的五子棋游戏，支持双人对战，拥有Qt打造的图形界面和形象的棋子。

在基础的国际象棋走子规则（不包含升变成后以外的棋子，过路兵，王车易位）之外，扩充了Time_Piece的概念。

配合Time_Piece的有一个Time_Machine，可以回溯到任意一个轮到该玩家操作的时间点，查看棋盘状态，选择继续回溯或者返回，确定或者放弃回溯。

Time_Piece将在时间回溯中保持不动，时间回溯可以复活死亡的棋子，但是死亡的棋子会有生命周期至其原定死亡的地方。

在回溯中位置被Time_Piece占据的棋子将直接死亡，但可以在下一次回溯中被复活。

## 2.结构设计

具体的代码结构可以详见structure.txt和其他的具体程序。这里将简要介绍其中的逻辑

整体代码分为UI部分，core部分和test部分。

### 2.1 UI部分

UI部分主要处理图形界面，包括了主棋盘，各种按钮，游戏相关信息，还有游戏的控制端。

PlayerInfoWidget.h和PlayerInfoWidget.cpp主要负责显示游戏相关信息，包括当前玩家，游戏状态，以及两个玩家的棋子信息。

BoardWidget.h和BoardWidget.cpp主要负责棋盘的绘制，包括棋盘的背景，棋子的绘制。

OperationWidget.h和OperationWidget.cpp主要负责游戏的控制，包括开始游戏，回溯，前进，放弃，确认的点击信号接收，传递给MainWindow。

MainWindow.h和MainWindow.cpp主要负责将各个部分收到的信息整合在一起，作为函数处理，在函数内部调用core的内容，主要是Game.cpp。

### 2.2 core部分

core部分主要维护游戏逻辑，包括棋盘和棋子的关系，棋子的选择，移动，生存与死亡，时间性质，以及处理时间回溯，游戏记录和玩家的相关信息。

Game.h和Game.cpp主要负责游戏逻辑，包括棋盘和棋子的关系，棋子的选择，移动，吃，生存与死亡，时间回溯，还有游戏的记录，玩家的相关信息。

Board.h和Board.cpp主要负责棋盘信息的存储和读取

Piece.h和Piece.cpp主要负责棋子信息的存储和读取

Player.h和Player.cpp主要负责玩家信息的存储和读取

### 2.3 test部分

test部分主要负责测试core的功能，包括棋盘的绘制，棋子的移动，吃，生存与死亡，时间回溯，还有游戏的记录，玩家的相关信息。

## 3. 功能实现

### 3.1 棋盘绘制

利用paint event作出各种矩形，并利用QPainter绘制棋子。

同时棋盘上下方各有一个长条，在该玩家的回合会亮起该玩家的标志色。

在一个棋子被选中的时候将会高亮这个格子。

### 3.2 棋子绘制

棋子的图片来源于pic文件夹，是我在网上下载并编辑了色调，更改成了透明的形式。

棋子用pixmap更改大小，并利用QPainter绘制棋子。

对于复活的死亡棋子，会在右上角用标志色标出他的生命周期。

对于在回溯过程中被Time_Piece占据的棋子，会半透明地覆盖显示。他的实现技术是创建了额外的list，并用Qpainter一并按照绘制规则绘制。






